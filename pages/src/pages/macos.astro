---
import { joinURL } from "ufo";

import Layout from "../layouts/Layout.astro";

import { getLatestRelease } from "../lib/github";

const { BASE_URL } = import.meta.env;

const release = await getLatestRelease();

const asset = release.assets.find((e) => /macos-universal\.pkg/.test(e.name));
if (!asset) throw new Error("macOS asset not found!");
---

<Layout
  lang="en"
  title="How to use OBS Background Removal on macOS"
  description="How to use OBS Background Removal on macOS"
>
  <main class="white-box">
    <h1>Install OBS Background Removal on macOS</h1>

    <div style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 12px; margin-bottom: 20px;">
      <strong>⚠️ Architecture Compatibility Warning:</strong><br />
      This plugin does <strong>NOT</strong> support cross-architecture translation (Rosetta2). If you run an Intel OBS binary on Apple Silicon via Rosetta2, or an Apple Silicon binary on Intel Macs, the plugin will crash. Always use OBS Studio and this plugin built for your Mac's native architecture.
    </div>

    <ol>
      <li>
        <strong>Download the Plugin Installer:</strong><br />
        <a href={asset.browser_download_url} download>
          Click here to download the latest macOS installer (PKG)
        </a>
      </li>
      <li>
        <strong>Run the Installer:</strong><br />
        Double-click <code>{asset.name}</code> and follow the instructions to install.
      </li>
      <li>
        <strong>Restart OBS Studio:</strong><br />
        If OBS Studio is running, close it and open it again.
      </li>
      <li>
        <strong>Usage:</strong><br />
        See the <a href={joinURL(BASE_URL, "usage/")}>usage page</a> for how to use
        the plugin.
      </li>
    </ol>

    <p>All set!</p>

    <p><a href={joinURL(BASE_URL, "/")}>Back to the top page</a></p>
  </main>
</Layout>
